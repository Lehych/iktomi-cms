
{% macro buttons() %}
  <div class="buttons form-controls init-block" data-block-name="compact-buttons" data-compact-name="form-controls">
    <a class="compact-toggle" title="Компактный вид"></a>
    {%- if save_allowed -%}
    <a href="" class="button icon-apply" style="margin-left: 15px" rel="save-and-continue"
       data-item-lock="true"
       data-item-form="true">
      Сохранить
    </a>
    {%- endif -%}
  </div>
{% endmacro %}


{% block content %}
<div class="init-block" data-block-name="title" data-title="{{ title }}"></div>
<div class="init-block" data-block-name="menu" data-menu="{{ menu }}"></div>

<form id="item-form"
      class="init-block item-form"
      action="{{ loner.url_for(env) }}"
      method="post"
      enctype="multipart/form-data"
      data-block-name="item-form"
      {%- if autosave_allowed %} data-autosave="{{ loner.url_for(env, 'autosave') }}"{% endif %}
      {%- if form.presavehooks is defined %} data-presavehooks="{{ ' '.join(form.presavehooks) }}"{% endif %}>

  <div class="content">
    <div class="header">
      <h1>{{ title }}</h1>
      {% block after_title %}{% endblock -%}
      {% block buttons_top %}{{ buttons() }}{% endblock %}
       {% from "macros/autosave_status.html" import autosave_status %}
       {{ autosave_status(autosave_allowed, draft) }}
    </div>

    <div class="text">
      <div class="line"></div>
      <div class="form">
          {{ form.render() }}
      </div>
    </div>

    {% block preview %}{% endblock %}
  </div>
  {%- if form.item.id and item_lock -%}
    {% from 'macros/item_lock.html' import main as item_lock with context %}
    {{ item_lock(form.item, url_for('index'), lock_timeout, lock_message, edit_session) }}
  {%- endif -%}
</form>
{% endblock %}
